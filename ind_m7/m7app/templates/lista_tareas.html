{% extends 'base.html' %}
{% load static %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function() {
    $('.completar-tarea').click(function(e) {
      e.preventDefault();
      
      var url = $(this).attr('href');
      
      $.ajax({
        url: url,
        type: 'POST',
        dataType: 'json',
        success: function(response) {
          if (response.success) {
            location.reload(); // Actualizar la página
          }
        }
      });
    });
  });
  </script>

{% block content %}
<h1>Listado de Tareas</h1>

<form method="GET">
  <label for="etiqueta">Etiqueta:</label>
  <select name="etiqueta" id="etiqueta">
    <option value="">Todas las Etiquetas</option>
    {% for etiqueta in etiquetas %}
      <option value="{{ etiqueta.id }}">{{ etiqueta.nombre }}</option>
    {% endfor %}
  </select>
  <button type="submit">Filtrar</button>
</form>

<table class="table table-responsive">
  <thead class="bg-light">
    <tr>
      <th>Título</th>
      <th>Descripción</th>
      <th>Fecha de Vencimiento</th>
      <th>Estado</th>
      <th>Etiqueta</th>
      <th>Prioridad</th>
      <th colspan="3">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for tarea in tareas_pendientes %}
      <tr>
        <td>{{ tarea.titulo }}</td>
        <td>{{ tarea.descripcion }}</td>
        <td>{{ tarea.fecha_vencimiento }}</td>
        <td>{{ tarea.estado }}</td>
        <td>{{ tarea.etiqueta.nombre }}</td>
        {% comment %} <td>{{ tarea.prioridad }}</td> {% endcomment %}
        <td>
          <form class="prioridad-form" action="{% url 'editar_prioridad' tarea.id %}" method="POST">
            {% csrf_token %}
            <select name="prioridad" class="form-control" onchange="this.form.submit()">
              {% for choice in prioridades %}
                <option value="{{ choice }}" {% if choice == tarea.prioridad %}selected{% endif %}>{{ choice }}</option>
              {% endfor %}
            </select>
          </form>
        </td>
        
        
        <td>
          <a href="{% url 'ver_tarea' tarea.id %}" class="btn btn-primary">Ver</a>
        </td>
        <td>
          <a href="{% url 'completar_tarea' tarea.id %}" class="btn btn-success completar-tarea"><i class="fa fa-check"></i> Completar</a>
        </td>
        <td>
          <a href="{% url 'confirmar_eliminar_tarea' tarea.id %}" class="btn btn-danger"><i class="fa fa-times"></i> X </a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<a href="{% url 'crear_tarea' %}" class="btn btn-primary">Agregar Tarea</a>

<hr>

<br>
<h3>Tareas Completadas</h3>

<table>
  <thead>
    <tr>
      <th>Título</th>
      <th>Fecha de Vencimiento</th>
      <!-- Otros encabezados de columna -->
    </tr>
  </thead>
  <tbody>
    {% for tarea in tareas_completadas %}
      <tr>
        <td>{{ tarea.titulo }}</td>
        <td>{{ tarea.fecha_vencimiento }}</td>
        <td>
          <a href="{% url 'ver_tarea' tarea.id %}" class="btn btn-primary btn-sm">Ver</a>
        </td>
        <td>
          <a href="{% url 'confirmar_eliminar_tarea' tarea.id %}" class="btn btn-primary btn-sm"><i class="fa fa-times"></i> x </a>
        </td>
        <!-- Otros datos de la tarea -->
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
{% block content2 %}
{% endblock %}


